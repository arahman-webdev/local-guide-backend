generator client {
  provider = "prisma-client"
  output   = "../src/generated"
}

datasource db {
  provider = "postgresql"
}

// -------------------------
// Users & Roles
// 

model User {
  id          String   @id @default(cuid())
  name        String
  email       String   @unique
  password    String
  role        UserRole @default(TOURIST)
  profilePic  String?
  bio         String?
  languages   String[] // array of languages
  travelPrefs String? // for tourist
  expertise   String? // for guide
  dailyRate   Float? // for guide

  isBlocked Boolean  @default(false)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  tours    Tour[]
  bookings Booking[]
  reviews  Review[]
}

enum UserRole {
  TOURIST
  GUIDE
  ADMIN
}

// -------------------------
// Tour Listings
// -------------------------
model Tour {
  id      String @id @default(cuid())
  title        String
  slug String @unique
  description  String
  itinerary    String
  fee          Float
  duration     Int // in hours
  meetingPoint String
  maxGroupSize Int
  images       String[] // URLs of images

  category TourCategory
  language String
  city     String

  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  bookings Booking[]
  reviews  Review[]
  user     User    @relation(fields: [userId], references: [id])
  userId   String
}

enum TourCategory {
  FOOD
  ART
  ADVENTURE
  HISTORY
  NIGHTLIFE
  SHOPPING
  OTHER
}

// -------------------------
// Bookings
// -------------------------
model Booking {
  id     String @id @default(cuid())
  tour   Tour   @relation(fields: [tourId], references: [id])
  tourId String

  status    BookingStatus @default(PENDING)
  startTime DateTime
  endTime   DateTime

  payment Payment?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  user      User   @relation(fields: [userId], references: [id])
  userId    String
}

enum BookingStatus {
  PENDING
  CONFIRMED
  COMPLETED
  CANCELLED
}

// -------------------------
// Payments
// -------------------------
model Payment {
  id        String  @id @default(cuid())
  booking   Booking @relation(fields: [bookingId], references: [id])
  bookingId String  @unique

  amount        Float
  method        PaymentMethod
  status        PaymentStatus @default(PENDING)
  transactionId String? // from Stripe/other gateway

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

enum PaymentMethod {
  STRIPE
  SSL_COMMERZ
  OTHER
}

enum PaymentStatus {
  PENDING
  COMPLETED
  FAILED
}

// -------------------------
// Reviews
// -------------------------
model Review {
  id     String @id @default(cuid())
  tour   Tour   @relation(fields: [tourId], references: [id])
  tourId String

  rating    Int // 1-5
  comment   String?
  createdAt DateTime @default(now())

  user   User   @relation(fields: [userId], references: [id])
  userId String
}
